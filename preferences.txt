Imports System.IO
Imports System.Xml



Public Class _preferences

    Dim t(12)
    Dim tcount As Integer = 0

    Public Sub newsaveconfig()
        Dim doc As New XmlDocument

        Dim thispref As XmlNode = Nothing
        Dim xmlproc As XmlDeclaration

        xmlproc = doc.CreateXmlDeclaration("1.0", "UTF-8", "yes")
        doc.AppendChild(xmlproc)
        Dim root As XmlElement
        Dim child As XmlElement
        root = doc.CreateElement("xbmc_media_companion_config_v1.0")


        child = doc.CreateElement("keepfoldername")
        child.InnerText = Form1.userprefs.keepfoldername.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("startupcache")
        child.InnerText = Form1.userprefs.startupcache.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("ignoretrailers")
        child.InnerText = Form1.userprefs.ignoretrailers.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("ignoreactorthumbs")
        child.InnerText = Form1.userprefs.ignoreactorthumbs.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("maxactors")
        child.InnerText = Form1.userprefs.maxactors.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("enablehdtags")
        child.InnerText = Form1.userprefs.enablehdtags.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("renamenfofiles")
        child.InnerText = Form1.userprefs.renamenfofiles.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("checkinfofiles")
        child.InnerText = Form1.userprefs.checkinfofiles.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("disablelogfiles")
        child.InnerText = Form1.userprefs.disablelogfiles.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("fanartnotstacked")
        child.InnerText = Form1.userprefs.fanartnotstacked.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("posternotstacked")
        child.InnerText = Form1.userprefs.posternotstacked.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("downloadfanart")
        child.InnerText = Form1.userprefs.downloadfanart.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("scrapemovieposters")
        child.InnerText = Form1.userprefs.scrapemovieposters.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("usefanart")
        child.InnerText = Form1.userprefs.usefanart.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("dontdisplayposter")
        child.InnerText = Form1.userprefs.dontdisplayposter.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("keepfoldername")
        child.InnerText = Form1.userprefs.keepfoldername.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("rarsize")
        child.InnerText = Form1.userprefs.rarsize.ToString
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("actorsave")
        child.InnerText = Form1.userprefs.actorsave.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("actorsavepath")
        child.InnerText = Form1.userprefs.actorsavepath
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("actornetworkpath")
        child.InnerText = Form1.userprefs.actornetworkpath
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("resizefanart")
        child.InnerText = Form1.userprefs.resizefanart.ToString
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("overwritethumbs")
        child.InnerText = Form1.userprefs.overwritethumbs.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("defaulttvthumb")
        child.InnerText = Form1.userprefs.defaulttvthumb
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("imdbmirror")
        child.InnerText = Form1.userprefs.imdbmirror
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("backgroundcolour")
        child.InnerText = Form1.userprefs.backgroundcolour
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("forgroundcolour")
        child.InnerText = Form1.userprefs.forgroundcolour
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("remembersize")
        child.InnerText = Form1.userprefs.remembersize.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("formheight")
        child.InnerText = Form1.userprefs.formheight.ToString
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("formwidth")
        child.InnerText = Form1.userprefs.formwidth.ToString
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("videoplaybackmode")
        child.InnerText = Form1.userprefs.videoplaybackmode.ToString
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("createfolderjpg")
        child.InnerText = Form1.userprefs.createfolderjpg.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("basicsavemode")
        child.InnerText = Form1.userprefs.basicsavemode.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("startupdisplaynamemode")
        child.InnerText = Form1.userprefs.startupdisplaynamemode.ToString
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("namemode")
        child.InnerText = Form1.userprefs.namemode
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("tvdbmode")
        child.InnerText = Form1.userprefs.tvdbmode
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("tvdbactorscrape")
        child.InnerText = Form1.userprefs.tvdbactorscrape.ToString
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("usetransparency")
        child.InnerText = Form1.userprefs.usetransparency.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("transparencyvalue")
        child.InnerText = Form1.userprefs.transparencyvalue.ToString
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("downloadtvfanart")
        child.InnerText = Form1.userprefs.downloadtvfanart.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("downloadtvposter")
        child.InnerText = Form1.userprefs.downloadtvposter.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("downloadtvseasonthumbs")
        child.InnerText = Form1.userprefs.downloadtvseasonthumbs.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("maximumthumbs")
        child.InnerText = Form1.userprefs.maximumthumbs.ToString
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("startupmode")
        child.InnerText = Form1.userprefs.startupmode.ToString
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("hdtags")
        child.InnerText = Form1.userprefs.hdtags.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("disablelogs")
        child.InnerText = Form1.userprefs.disablelogs.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("overwritethumb")
        child.InnerText = Form1.userprefs.overwritethumb.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("savefanart")
        child.InnerText = Form1.userprefs.savefanart.ToString.ToLower
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("postertype")
        child.InnerText = Form1.userprefs.postertype
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("tvactorscrape")
        child.InnerText = Form1.userprefs.tvactorscrape.ToString
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("videomode")
        child.InnerText = Form1.userprefs.videomode.ToString
        root.AppendChild(child)

        child.RemoveAll()
        child = doc.CreateElement("selectedvideoplayer")
        child.InnerText = Form1.userprefs.selectedvideoplayer
        root.AppendChild(child)
        
        



















        doc.AppendChild(root)
        Dim output As New XmlTextWriter(Form1.userprefs.configpath, System.Text.Encoding.UTF8)
        output.Formatting = Formatting.Indented
        doc.WriteTo(output)
        output.close()



    End Sub

    Public Sub loadconfig()

        If Not IO.File.Exists(Form1.userprefs.configpath) Then
            Exit Sub
        End If

        Dim prefs As New XmlDocument
        Try
            prefs.Load(Form1.userprefs.configpath)
        Catch ex As Exception
            MsgBox("Error : pr24")
        End Try

        Dim thisresult As XmlNode = Nothing

        For Each thisresult In prefs("xbmc_media_companion_config_v1.0")
            Try
                Dim p As String = thisresult.Value
                Dim d As String = thisresult.InnerXml
                Select Case thisresult.Name
                    Case "nfofolder"
                        Form1.moviefolders.Add(thisresult.InnerXml)
                    Case "keepfoldername"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.keepfoldername = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.keepfoldername = False
                        End If
                    Case "startupcache"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.startupcache = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.startupcache = False
                        End If
                    Case "ignoretrailers"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.ignoretrailers = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.ignoretrailers = False
                        End If
                    Case "ignoreactorthumbs"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.ignoreactorthumbs = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.ignoreactorthumbs = False
                        End If
                    Case "maxactors"
                        Form1.userprefs.maxactors = Convert.ToInt16(thisresult.InnerXml)
                    Case "maxmoviegenre"
                        Form1.userprefs.maxmoviegenre = Convert.ToInt16(thisresult.InnerXml)
                    Case "enablehdtags"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.enablehdtags = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.enablehdtags = False
                        End If
                    Case "renamenfofiles"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.renamenfofiles = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.renamenfofiles = False
                        End If
                    Case "checkinfofiles"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.checkinfofiles = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.checkinfofiles = False
                        End If
                    Case "disablelogfiles"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.disablelogfiles = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.disablelogfiles = False
                        End If
                    Case "fanartnotstacked"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.fanartnotstacked = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.fanartnotstacked = False
                        End If
                    Case "posternotstacked"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.posternotstacked = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.posternotstacked = False
                        End If
                    Case "downloadfanart"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.downloadfanart = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.downloadfanart = False
                        End If
                    Case "scrapemovieposters"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.scrapemovieposters = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.scrapemovieposters = False
                        End If
                    Case "usefanart"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.usefanart = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.usefanart = False
                        End If
                    Case "dontdisplayposter"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.dontdisplayposter = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.dontdisplayposter = False
                        End If
                    Case "rarsize"
                        Form1.userprefs.rarsize = Convert.ToInt16(thisresult.InnerXml)
                    Case "actorsave"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.actorsave = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.actorsave = False
                        End If
                    Case "actorsavepath"
                        Form1.userprefs.actorsavepath = thisresult.InnerXml
                    Case "actornetworkpath"
                        Form1.userprefs.actornetworkpath = thisresult.InnerXml
                    Case "resizefanart"
                        Form1.userprefs.resizefanart = Convert.ToInt16(thisresult.InnerXml)
                    Case "overwritethumbs"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.overwritethumbs = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.overwritethumbs = False
                        End If
                    Case "defaulttvthumb"
                        Form1.userprefs.defaulttvthumb = thisresult.InnerXml
                    Case "imdbmirror"
                        Form1.userprefs.imdbmirror = thisresult.InnerXml
                    Case "moviethumbpriority"
                        ReDim Form1.userprefs.moviethumbpriority(3)
                        Form1.userprefs.moviethumbpriority = thisresult.InnerXml.Split("|")
                    Case "certificatepriority"
                        ReDim Form1.userprefs.certificatepriority(33)
                        Form1.userprefs.certificatepriority = thisresult.InnerXml.Split("|")
                    Case "backgroundcolour"
                        Form1.userprefs.backgroundcolour = thisresult.InnerXml
                    Case "forgroundcolour"
                        Form1.userprefs.forgroundcolour = thisresult.InnerXml
                    Case "remembersize"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.remembersize = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.remembersize = False
                        End If
                    Case "formheight"
                        Form1.userprefs.formheight = Convert.ToInt16(thisresult.InnerXml)
                    Case "formwidth"
                        Form1.userprefs.formwidth = Convert.ToInt16(thisresult.InnerXml)
                    Case "videoplaybackmode"
                        Form1.userprefs.videoplaybackmode = Convert.ToInt16(thisresult.InnerXml)
                    Case "usefoldernames"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.usefoldernames = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.usefoldernames = False
                        End If
                    Case "createfolderjpg"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.createfolderjpg = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.createfolderjpg = False
                        End If
                    Case "basicsavemode"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.basicsavemode = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.basicsavemode = False
                        End If
                    Case "startupdisplaynamemode"
                        Form1.userprefs.startupdisplaynamemode = Convert.ToInt16(thisresult.InnerXml)
                    Case "namemode"
                        Form1.userprefs.namemode = thisresult.InnerXml
                    Case "tvdblanguage"
                        Dim partone() As String
                        partone = thisresult.InnerXml.Split("|")
                        For f = 0 To 1
                            If partone(0).Length = 2 Then
                                Form1.userprefs.tvdblanguagecode = partone(0)
                                Form1.userprefs.tvdblanguage = partone(1)
                                Exit For
                            Else
                                Form1.userprefs.tvdblanguagecode = partone(1)
                                Form1.userprefs.tvdblanguage = partone(0)
                            End If
                        Next
                    Case "tvdbmode"
                        Form1.userprefs.tvdbmode = thisresult.InnerXml
                    Case "tvdbactorscrape"
                        Form1.userprefs.tvdbactorscrape = Convert.ToInt16(thisresult.InnerXml)
                    Case "usetransparency"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.usetransparency = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.usetransparency = False
                        End If
                    Case "transparencyvalue"
                        Form1.userprefs.transparencyvalue = Convert.ToInt16(thisresult.InnerXml)
                    Case "downloadtvfanart"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.downloadtvfanart = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.downloadtvfanart = False
                        End If
                    Case "downloadtvposter"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.downloadtvposter = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.downloadtvposter = False
                        End If
                    Case "downloadtvseasonthumbs"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.downloadtvseasonthumbs = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.downloadtvseasonthumbs = False
                        End If
                    Case "maximumthumbs"
                        Form1.userprefs.maximumthumbs = Convert.ToInt16(thisresult.InnerXml)
                    Case "startupmode"
                        Form1.userprefs.startupmode = Convert.ToInt16(thisresult.InnerXml)
                    Case "hdtags"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.hdtags = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.hdtags = False
                        End If
                    Case "disablelogs"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.disablelogs = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.disablelogs = False
                        End If
                    Case "overwritethumb"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.overwritethumb = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.overwritethumb = False
                        End If
                    Case "folderjpg"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.createfolderjpg = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.createfolderjpg = False
                        End If
                    Case "savefanart"
                        If thisresult.InnerXml = "true" Then
                            Form1.userprefs.savefanart = True
                        ElseIf thisresult.InnerXml = "false" Then
                            Form1.userprefs.savefanart = False
                        End If
                    Case "postertype"
                        Form1.userprefs.postertype = thisresult.InnerXml
                    Case "tvactorscrape"
                        Form1.userprefs.tvactorscrape = Convert.ToInt16(thisresult.InnerXml)
                    Case "videomode"
                        Form1.userprefs.videomode = Convert.ToInt16(thisresult.InnerXml)
                    Case "selectedvideoplayer"
                        Form1.userprefs.selectedvideoplayer = thisresult.InnerXml
                End Select
            Catch
                MsgBox("Error : pr278")
            End Try
        Next
        Call newsaveconfig()
    End Sub





    Public Sub saveconfig()

        Dim fileInUse As Boolean = True




        Dim file As IO.StreamWriter = IO.File.CreateText(Form1.profiles(Form1.workingprofile, 1))
        file.WriteLine("<xbmc_media_companion_config_v1.0>")
        'For f = 1 To ammountofpaths
        '    If nfopaths(f) <> "" And nfopaths(f) <> Nothing Then
        '        file.WriteLine("<nfofolder>" & nfopaths(f) & "</nfofolder>")
        '    End If
        'Next
        'For f = 1 To ammountoftvpaths
        '    If tvshowpaths(f) <> "" And tvshowpaths(f) <> Nothing Then
        '        file.WriteLine("<tvshowfolder>" & tvshowpaths(f) & "</tvshowfolder>")
        '    End If
        'Next

        If Form1.userprefs.keepfoldername = False Then
            file.WriteLine("<keepfoldername>false</keepfoldername>")
        Else
            file.WriteLine("<keepfoldername>true</keepfoldername>")
        End If
        If Form1.userprefs.ignoretrailers = False Then
            file.WriteLine("<ignoretrailers>false</ignoretrailers>")
        Else
            file.WriteLine("<ignoretrailers>true</ignoretrailers>")
        End If
        If Form1.userprefs.ignoreactorthumbs = True Then
            file.WriteLine("<ignoreactorthumbs>true</ignoreactorthumbs>")
        Else
            file.WriteLine("<ignoreactorthumbs>false</ignoreactorthumbs>")
        End If
        If Form1.userprefs.maxactors = 9999 Then
            file.WriteLine("<maxactors>9999</maxactors>")
        ElseIf Form1.userprefs.maxactors = 0 Then
            file.WriteLine("<maxactors>0</maxactors>")
        Else
            file.WriteLine("<maxactors>" & Form1.userprefs.maxactors.ToString & "</maxactors>")
        End If

        If Form1.userprefs.maxmoviegenre = 9999 Then
            file.WriteLine("<maxmoviegenre>9999</maxmoviegenre>")
        ElseIf Form1.userprefs.maxmoviegenre = 0 Then
            file.WriteLine("<maxmoviegenre>0</maxmoviegenre>")
        Else
            file.WriteLine("<maxmoviegenre>" & Form1.userprefs.maxmoviegenre.ToString & "</maxmoviegenre>")
        End If

        If Form1.userprefs.hdtags = True Then
            file.WriteLine("<enablehdtags>true</enablehdtags>")
        Else
            file.WriteLine("<enablehdtags>false</enablehdtags>")
        End If
        If Form1.userprefs.startupcache = True Then
            file.WriteLine("<startupcache>true</startupcache>")
        Else
            file.WriteLine("<startupcache>false</startupcache>")
        End If
        If Form1.userprefs.renamenfofiles = False Then
            file.WriteLine("<renamenfofiles>false</renamenfofiles>")
        Else
            file.WriteLine("<renamenfofiles>true</renamenfofiles>")
        End If

        If Form1.userprefs.checkinfofiles = False Then
            file.WriteLine("<checkinfofiles>false</checkinfofiles>")
        Else
            file.WriteLine("<checkinfofiles>true</checkinfofiles>")
        End If
        If Form1.userprefs.disablelogs = True Then
            file.WriteLine("<disablelogfiles>true</disablelogfiles>")
        Else
            file.WriteLine("<disablelogfiles>false</disablelogfiles>")
        End If

        If Form1.userprefs.fanartnotstacked = True Then
            file.WriteLine("<fanartnotstacked>true</fanartnotstacked>")
        Else
            file.WriteLine("<fanartnotstacked>false</fanartnotstacked>")
        End If

        If Form1.userprefs.posternotstacked = True Then
            file.WriteLine("<posternotstacked>true</posternotstacked>")
        Else
            file.WriteLine("<posternotstacked>false</posternotstacked>")
        End If


        If Form1.userprefs.savefanart = True Then
            file.WriteLine("<downloadfanart>true</downloadfanart>")
        Else
            file.WriteLine("<downloadfanart>false</downloadfanart>")
        End If

        If Form1.userprefs.scrapemovieposters = True Then
            file.WriteLine("<downloadposters>true</downloadposters>")
        Else
            file.WriteLine("<downloadposters>false</downloadposters>")
        End If


        If Form1.userprefs.usefanart = True Then
            file.WriteLine("<usefanart>true</usefanart>")
        Else
            file.WriteLine("<usefanart>false</usefanart>")
        End If

        If Form1.userprefs.dontdisplayposter = True Then
            file.WriteLine("<dontdisplayposter>true</dontdisplayposter>")
        Else
            file.WriteLine("<dontdisplayposter>false</dontdisplayposter>")
        End If
        If IsNumeric(Form1.userprefs.rarsize) Then
            file.WriteLine("<rarsize>" & Form1.userprefs.rarsize.ToString & "</rarsize>")
        Else
            file.WriteLine("<rarsize>8</rarsize>")
        End If

        If Form1.userprefs.actorsave = True And Form1.userprefs.actorsavepath <> "" And Form1.userprefs.actornetworkpath <> "" Then
            file.WriteLine("<actorsave>true</actorsave>")
            file.WriteLine("<actorsavepath>" & Form1.userprefs.actorsavepath & "</actorsavepath>")
            file.WriteLine("<actornetworkpath>" & Form1.userprefs.actornetworkpath & "</actornetworkpath>")
        Else
            file.WriteLine("<actorsave>false</actorsave>")
        End If






        file.WriteLine("<fanartresize>" & Form1.userprefs.resizefanart.ToString & "</fanartresize>")

        If Form1.userprefs.overwritethumb = True Then
            file.WriteLine("<overwritethumbs>true</overwritethumbs>")
        ElseIf Form1.userprefs.overwritethumb = False Then
            file.WriteLine("<overwritethumbs>false</overwritethumbs>")
        End If
        If Form1.userprefs.postertype = "poster" Then
            file.WriteLine("<defaulttvthumb>poster</defaulttvthumb>")
        ElseIf Form1.userprefs.postertype = "banner" Then
            file.WriteLine("<defaulttvthumb>banner</defaulttvthumb>")
        Else
            file.WriteLine("<defaulttvthumb>banner</defaulttvthumb>")
        End If

        If Form1.WindowState = FormWindowState.Normal Then
            file.WriteLine("<formheight>" & Form1.Height.ToString & "</formheight>")
            file.WriteLine("<formwidth>" & Form1.Width.ToString & "</formwidth>")
        ElseIf Form1.WindowState = FormWindowState.Maximized Then
            file.WriteLine("<formheight>maximised</formheight>")
            file.WriteLine("<formwidth>maximised</formwidth>")
        End If

        file.WriteLine("<imdbmirror>" & Form1.userprefs.imdbmirror & "</imdbmirror>")
        Dim tempstring As String
        tempstring = "<moviethumbpriority>"
        For f = 0 To 3
            If f < 3 Then
                tempstring = tempstring & Form1.userprefs.moviethumbpriority(f) & "|"
            Else
                tempstring = tempstring & Form1.userprefs.moviethumbpriority(f) & "</moviethumbpriority>"
            End If
        Next
        file.WriteLine(tempstring)






        tempstring = "<certificatepriority>"
        For f = 0 To 33
            If f < 33 Then
                tempstring = tempstring & Form1.userprefs.certificatepriority(f) & "|"
            Else
                tempstring = tempstring & Form1.userprefs.certificatepriority(f) & "</certificatepriority>"
            End If
        Next
        file.WriteLine(tempstring)











        Dim bckcolour As String
        Dim forcolour As String
        bckcolour = ColorTranslator.ToHtml(Form1.BackColor)
        forcolour = ColorTranslator.ToHtml(Form1.titletxt.BackColor)
        file.WriteLine("<backgroundcolour>" & bckcolour & "</backgroundcolour>")
        file.WriteLine("<forgroundcolour>" & forcolour & "</forgroundcolour>")

        file.WriteLine("<formheight>" & Form1.Height.ToString & "</formheight>")
        file.WriteLine("<formwidth>" & Form1.Width.ToString & "</formwidth>")


        If Form1.userprefs.videomode = 1 Then file.WriteLine("<videoplaybackmode>1</videoplaybackmode>")
        If Form1.userprefs.videomode = 2 Then file.WriteLine("<videoplaybackmode>2</videoplaybackmode>")
        If Form1.userprefs.videomode = 3 Then file.WriteLine("<videoplaybackmode>3</videoplaybackmode>")
        If Form1.userprefs.videomode = 4 Then file.WriteLine("<videoplaybackmode>4</videoplaybackmode>")
        If Form1.userprefs.selectedvideoplayer <> Nothing Then
            file.WriteLine("<selectedvideoplayer>" & Form1.userprefs.selectedvideoplayer & "</selectedvideoplayer>")
        End If

        If Form1.userprefs.usefoldernames = True Then
            file.WriteLine("<usefoldernames>true</usefoldernames>")
        ElseIf Form1.userprefs.usefoldernames = False Then
            file.WriteLine("<usefoldernames>false</usefoldernames>")
        End If

        If Form1.userprefs.createfolderjpg = True Then
            file.WriteLine("<createfolderjpg>true</createfolderjpg>")
        ElseIf Form1.userprefs.createfolderjpg = False Then
            file.WriteLine("<createfolderjpg>false</createfolderjpg>")
        End If

        If Form1.userprefs.basicsavemode = True Then
            file.WriteLine("<basicsavemode>true</basicsavemode>")
        ElseIf Form1.userprefs.basicsavemode = False Then
            file.WriteLine("<basicsavemode>false</basicsavemode>")
        End If




        If Form1.userprefs.startupmode < 3 Then
            file.WriteLine("<startupmode>" & Form1.userprefs.startupmode.ToString & "</startupmode>")
        ElseIf Form1.userprefs.startupmode >= 3 Then
            If Form1.mode = "tv" Then
                file.WriteLine("<startupmode>4</startupmode>")
            ElseIf Form1.mode = "movie" Then
                file.WriteLine("<startupmode>3</startupmode>")
            End If
        End If

        If Form1.userprefs.startupdisplaynamemode = 1 Then
            file.WriteLine("<namemode>1</namemode>")
        Else
            file.WriteLine("<namemode>2</namemode>")
        End If


        file.WriteLine("<tvdblanguage>" & Form1.userprefs.tvdblanguagecode & "|" & Form1.userprefs.tvdblanguage & "</tvdblanguage>")
        If Form1.userprefs.tvdbmode = "default" Then file.WriteLine("<tvdbmode>default</tvdbmode>")
        If Form1.userprefs.tvdbmode = "dvd" Then file.WriteLine("<tvdbmode>dvd</tvdbmode>")
        file.WriteLine("<tvdbactorscrape>" & Form1.userprefs.tvactorscrape.ToString & "</tvdbactorscrape>")
        If Form1.userprefs.usetransparency = True Then
            file.WriteLine("<usealpha>true</usealpha>")
        Else
            file.WriteLine("<usealpha>false</usealpha>")
        End If
        Dim tempint As Integer
        tempint = Form1.userprefs.transparencyvalue
        file.WriteLine("<alphavalue>" & tempint & "</alphavalue>")

        If Form1.userprefs.downloadtvfanart = True Then
            file.WriteLine("<downloadtvfanart>true</downloadtvfanart>")
        Else
            file.WriteLine("<downloadtvfanart>false</downloadtvfanart>")
        End If
        If Form1.userprefs.downloadtvposter = True Then
            file.WriteLine("<downloadtvposter>true</downloadtvposter>")
        Else
            file.WriteLine("<downloadtvposter>false</downloadtvposter>")
        End If
        If Form1.userprefs.downloadtvseasonthumbs = True Then
            file.WriteLine("<downloadtvseasonthumbs>true</downloadtvseasonthumbs>")
        Else
            file.WriteLine("<downloadtvseasonthumbs>false</downloadtvseasonthumbs>")
        End If


        file.WriteLine("</xbmc_media_companion_config_v1.0>")
        file.Close()

    End Sub







    Public Structure preferences
        Dim moviethumbpriority() As String
        Dim certificatepriority() As String
        Dim keepfoldername As Boolean
        Dim startupcache As Boolean
        Dim ignoretrailers As Boolean
        Dim ignoreactorthumbs As Boolean
        Dim maxactors As Integer
        Dim maxmoviegenre As Integer
        Dim enablehdtags As Boolean
        Dim renamenfofiles As Boolean
        Dim checkinfofiles As Boolean
        Dim disablelogfiles As Boolean
        Dim fanartnotstacked As Boolean
        Dim posternotstacked As Boolean
        Dim downloadfanart As Boolean
        Dim scrapemovieposters As Boolean
        Dim usefanart As Boolean
        Dim dontdisplayposter As Boolean
        Dim rarsize As Integer
        Dim actorsave As Boolean
        Dim actorsavepath As String
        Dim actornetworkpath As String
        Dim resizefanart As Integer
        Dim overwritethumbs As Boolean
        Dim defaulttvthumb As String
        Dim imdbmirror As String
        Dim backgroundcolour As String
        Dim forgroundcolour As String
        Dim remembersize As Boolean
        Dim formheight As Integer
        Dim formwidth As Integer
        Dim videoplaybackmode As Integer
        Dim usefoldernames As Boolean
        Dim createfolderjpg As Boolean
        Dim basicsavemode As Boolean
        Dim startupdisplaynamemode As Integer
        Dim namemode As String
        Dim tvdblanguage As String
        Dim tvdblanguagecode As String
        Dim tvdbmode As String
        Dim tvdbactorscrape As Integer
        Dim usetransparency As Boolean
        Dim transparencyvalue As Integer
        Dim downloadtvfanart As Boolean
        Dim downloadtvposter As Boolean
        Dim downloadtvseasonthumbs As Boolean
        Dim maximumthumbs As Integer
        Dim configpath As String

        Dim startupmode As Integer
        Dim hdtags As Boolean
        Dim disablelogs As Boolean

        Dim overwritethumb As Boolean
        Dim savefanart As Boolean
        Dim postertype As String
        Dim tvactorscrape As Integer
        Dim videomode As Integer ' = 3
        Dim selectedvideoplayer As String

    End Structure


End Class
